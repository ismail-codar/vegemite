!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.vegemite=t()}(this,function(){const e=require("klona");function t(e,n,o,i,f){var r,u=e[i++];return u?null==(r=u(o,n))?t(e,n,o,i):"function"==typeof r.then?r.then(o=>t(e,n,o,i,!0)):("object"==typeof r&&(o=r),t(e,n,o,i)):f?Promise.resolve(o):o}return function(n){var o,i={},f={},r=n||{},u=(e,t)=>{e.splice(e.indexOf(t)>>>0,1)};return o={get state(){return e(r)},on:(e,t)=>(i[e]=(i[e]||[]).concat(t),()=>u(i[e],t)),set(n,o){t((f["*"]||[]).concat(o&&f[o]||[]),r,e(r=n),0)},listen:(e,t)=>("function"==typeof e&&(t=e,e="*"),f[e]=(f[e]||[]).concat(t),()=>u(f[e],t)),dispatch(n,f){var u=t(i[n]||[],f,e(r),0);if("function"==typeof u.then)return u.then(e=>{if(null==e)throw"state did not returned!";o.set(e,n)});o.set(u,n)}}}});